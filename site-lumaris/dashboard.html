<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@1.1.0/dist/chartjs-chart-matrix.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-gauge@4.0.0/dist/chartjs-chart-gauge.min.js"></script>
  <link rel="stylesheet" href="css/dashboard.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="shortcut icon" href="./images/Lumaris.jpg" type="image/x-icon">
</head>

<body>

  <div class="container">
    <div>
      <a href="./index.html">
        <span class="material-icons" style="font-size: x-large;">arrow_back_ios</span>
      </a>
    </div>
    <div class="dash">
      <div class="nav">
        <div class="titulo">
          Bem-vindo, <span style="color: orange;">Mar√© Branca</span>!
        </div>
        <div class="options">
          
            <span class="material-icons" style="font-size: xx-large;"><a href="./notificacoes.html" style="margin-right: 20px; text-decoration: none;">notifications</a></span>
          
          <a href="./login.html">
            <span class="material-icons" style="font-size: xx-large;">logout</span>
          </a>
        </div>
      </div>
      <div class="alertas">
        <div class="alerta" onclick="openModal('sensores')">
          <div class="titulo">Sensores em risco</div>
          <div class="valor">0 de 13 <span class="material-icons">do_not_disturb_on</span></div>
        </div>
        <div class="alerta" onclick="openModal('luminosidade')">
          <div class="titulo">N√≠vel de Luminosidade atual</div>
          <div class="valor">934 <span class="material-icons">show_chart</span></div>
        </div>
        <div class="alerta" onclick="openModal('instabilidade')">
          <div class="titulo">Instabilidade luminosa</div>
          <div class="valor">Ver sensores <span class="material-icons" style="margin-left: 5px;">light_mode</span></div>
        </div>
        <div class="alerta" onclick="openModal('ideal')">
          <div class="titulo">Luminosidade da fazenda</div>
          <div class="valor">IDEAL <span class="material-icons">highlight</span></div>
        </div>
        <div class="alerta" onclick="openModal('todos')">
          <div class="titulo">Ver todos...</div>
        </div>
      </div>

      <div class="graficos">

        <div class="linhas">
          <canvas id="myChart"></canvas>
          <span class="material-icons"onclick="openModal('modal-linhas')" style="font-size: large;">info</span>
        </div>

        <div class="barras">
          <canvas id="myChart2"></canvas>
          <span class="material-icons"onclick="openModal('modal-barras')" style="font-size: large;">info</span>

        </div>
       
        <div class="donut" id="donut" style="height: 150px; width: 300px;">
          <p>Taxa de sobreviv√™ncia das ostras</p>
          <canvas id="myDonutChart"></canvas>
          <span class="material-icons" style="font-size: large;" onclick="openModal('modal-donut')">info</span>

        </div>
        <div class="economia" style="height: 150px; width: 300px;">
          Economia estimada por monitoramento <br>
          <h2>R$ <span>1.212,90</span>/mes</h2>
          <span class="material-icons" style="font-size: large;" onclick="openModal('modal-economia')">info</span>

        </div>
        
        <div class="lucro" style="height: 150px; width: 300px;">
          Lucro do m√™s passado (BRL) <br>
          <h2><span style="color: rgb(97, 193, 97);">R$123.212,90</span></h2>
          <span class="material-icons" style="font-size: large;" onclick="openModal('modal-lucro')">info</span>


        </div>
        <div class="temporizador" style="height: 150px; width: 300px;">
          Tempo restante <span id="estado" style="color: orange; font-weight: bold;">na LUZ</span><br>
          <h1><span id="temporizador">12:00:00</span></h1>
          <span class="material-icons" style="font-size: large;" onclick="openModal('modal-temporizador')">info</span>

        </div>   
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="myModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h2 id="modal-title">Informa√ß√µes</h2>
      <p id="modal-text">Texto informativo sobre o item.</p>
    </div>
  </div>

  <script>
    // Gr√°fico de linha
    const ctx = document.getElementById('myChart');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
        datasets: [{
          label: 'Lucro (BRL)',
          data: [720, 890, 900, 1200, 1296, 1567, 1777, 2500, 2763, 3012, 3212, 3754],
          borderWidth: 1,
          backgroundColor: 'darkgreen',
          maintainAspectRatio: false,
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });


    const ctx2 = document.getElementById('myChart2');

    // Hor√°rios do dia (de 00h a 23h)
    const horas = [
      '00h', '01h', '02h', '03h', '04h', '05h',
      '06h', '07h', '08h', '09h', '10h', '11h',
      '12h', '13h', '14h', '15h', '16h', '17h',
      '18h', '19h', '20h', '21h', '22h', '23h'
    ];

    // Dados de luminosidade (manual para cada hora)
    const luminosidade = [
      100, 150, 200, 250, 300, 350, 450, 600, 750, 850,
      900, 950, 1000, 950, 850, 750, 650, 550, 500, 450,
      400, 350, 250, 150, 100
    ];

    new Chart(ctx2, {
      type: 'bar',
      data: {
        labels: horas,
        datasets: [{
          label: 'Luminosidade ao longo do dia (LUX)',
          data: luminosidade,
          borderWidth: 1,
          backgroundColor: '#0ABAB5', // Cor amarela para simular a luminosidade
          borderColor: 'aliceblue',
          maintainAspectRatio: false,
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            max: 1000,  // M√°ximo de 100% de luminosidade
          },
          x: {
            grid:{
              display: false,
            }
          }
        }
      }
    });
       

    const ctx4 = document.getElementById('myDonutChart');

    new Chart(ctx4, {
      type: 'doughnut',
      data: {
        labels: ['Progresso', 'Faltando'],
        datasets: [{
          data: [75, 25],
          backgroundColor: ['darkslategray', '#E0E0E0'],
          borderWidth: 0,
          cutout: '80%',
        }]
      },
      options: {
        responsive: true,
        rotation: -90,
        circumference: 180,
        plugins: {
          legend: { display: false },
          tooltip: { enabled: false }
        }
      },
      plugins: [{
        beforeDraw(chart) {
          const { width, height, ctx } = chart;
          ctx.save();
          const fontSize = height / 4;
          ctx.font = `${fontSize}px sans-serif`;
          ctx.fillStyle = '#333';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText('75%', width / 2, height / 1.4);
          ctx.restore();
        }
      }]
    });


    function openModal(tipo) {
      const modal = document.getElementById("myModal");
      const title = document.getElementById("modal-title");
      const text = document.getElementById("modal-text");
      var mensagemTemporizador = `<div class="modal-conteudo">
    <h2>Tempo Restante na LUZ/ESCURO</h2>
    <p>Este temporizador conta o tempo restante de exposi√ß√£o √† luz para as ostras em uma fazenda. Dependendo do ciclo de luminosidade, as ostras podem ter um per√≠odo em que precisam estar expostas √† luz e outro per√≠odo em que devem estar no escuro.</p>
    <p><strong>Exemplo de uso:</strong> Esse temporizador ajuda a garantir que as ostras sejam expostas a ciclos ideais de luz e escurid√£o para otimizar o crescimento e a sa√∫de delas, seguindo as recomenda√ß√µes de pr√°ticas agr√≠colas espec√≠ficas.</p>
  </div>`;
      var mensagemLucro = `<div class="modal-conteudo">
    <h2>Lucro do M√™s Passado (BRL)</h2>
    <p>Exibe o lucro estimado do √∫ltimo m√™s, com base na produ√ß√£o de ostras e os custos operacionais. Ele √© √∫til para avaliar o desempenho financeiro da fazenda e o impacto de vari√°veis como luminosidade na produ√ß√£o.</p>
    <p><strong>Exemplo de uso:</strong> O lucro apresentado aqui √© um reflexo direto de como o controle das condi√ß√µes de cultivo, como a luminosidade, impactou a produ√ß√£o e, consequentemente, as finan√ßas da fazenda.</p>
  </div>`;
      var mensagemEconomia = ` <div class="modal-conteudo">
    <h2>Economia Estimada por Monitoramento</h2>
    <p>Esta se√ß√£o mostra a economia estimada que pode ser gerada com o monitoramento das condi√ß√µes de luminosidade nas fazendas de ostras. A tecnologia pode ajudar a otimizar o processo de cultivo, reduzindo custos e aumentando a produ√ß√£o.</p>
    <p><strong>Exemplo de uso:</strong> A economia apresentada aqui √© baseada na redu√ß√£o de perdas de produ√ß√£o atrav√©s do controle de luminosidade e outras vari√°veis ambientais monitoradas pelas ferramentas do sistema.</p>
  </div>`;
      var mensagemDonut = `<div class="modal-conteudo">
    <h2>Taxa de Sobreviv√™ncia das Ostras</h2>
    <p>O gr√°fico de donut √© uma varia√ß√£o do gr√°fico de pizza, mas com um centro vazio. Ele √© utilizado para mostrar a composi√ß√£o de uma vari√°vel em partes proporcionais, ideal para visualizar taxas.</p>
    <p><strong>Exemplo de uso:</strong> Este gr√°fico mostra a taxa de sobreviv√™ncia das ostras em rela√ß√£o √† quantidade total plantada. √â √∫til para monitorar a sa√∫de das ostras nas fazendas e identificar qualquer problema no ciclo de vida delas.</p>
  </div>`;
      var mensagemBarras = ` <div class="modal-conteudo">
    <h2>Gr√°fico de Barras</h2>
    <p>O gr√°fico de barras √© ideal para comparar dados entre diferentes categorias. Ele apresenta os valores de forma visualmente clara, permitindo uma compara√ß√£o f√°cil e r√°pida.</p>
    <p><strong>Exemplo de uso:</strong> Neste gr√°fico, voc√™ pode comparar a quantidade de luminosidade detectada na sua fazendas de ostras, ajudando a identificar quais locais est√£o recebendo mais ou menos luz e sua rela√ß√£o com a produ√ß√£o ao longo do dia.</p>
  </div>`;
      var mensagemLinhas = `
  <div class="modal-conteudo">
    <h2>Gr√°fico de Linhas</h2>
    <p>O gr√°fico de linhas √© utilizado para exibir a evolu√ß√£o dos dados ao longo do tempo. Este gr√°fico √© excelente para identificar tend√™ncias e padr√µes temporais, como crescimento ou decl√≠nio em um per√≠odo espec√≠fico.</p>
    <p><strong>Exemplo de uso:</strong> Voc√™ pode observar como a luminosidade na sua fazenda varia ao longo do dia ou da semana, o que pode ajudar a entender o impacto da luminosidade na produ√ß√£o de ostras.</p>
  </div>`;
      var mensagemInstabilidade = `
      <div class="area-sensores">

  <h1>Relat√≥rio de Instabilidade</h1>
  <div class="sensor-list">

    <div class="sensor adequada-borda">
      <h2>Sensor LDR 1</h2>
      <div class="description">Desempenho est√°vel com ilumina√ß√£o constante.</div>
      <div class="report adequada">Instabilidade: Adequada</div>
    </div>

    <div class="sensor adequada-borda">
      <h2>Sensor LDR 2</h2>
      <div class="description">Desempenho est√°vel com ilumina√ß√£o constante.</div>
      <div class="report adequada">Instabilidade: Adequada</div>
    </div>

    <div class="sensor critica-borda"">
      <h2>Sensor LDR 3</h2>
      <div class="description">Sens√≠vel, mas sofre interfer√™ncia de ru√≠do el√©trico.</div>
      <div class="report critica">Instabilidade: Cr√≠tica</div>
    </div>

    <div class="sensor adequada-borda">
      <h2>Sensor LDR 4</h2>
      <div class="description">Desempenho est√°vel com ilumina√ß√£o constante.</div>
      <div class="report adequada">Instabilidade: Adequada</div>
    </div>

    <div class="sensor adequada-borda">
      <h2>Sensor LDR 5</h2>
      <div class="description">Desempenho est√°vel com ilumina√ß√£o constante.</div>
      <div class="report adequada">Instabilidade: Adequada</div>
    </div>

    <div class="sensor adequada-borda"">
      <h2>Sensor LDR 6</h2>
      <div class="description">Desempenho est√°vel com ilumina√ß√£o constante.</div>
      <div class="report adequada">Instabilidade: Adequada</div>
    </div>

    <div class="sensor adequada-borda">
      <h2>Sensor LDR 7</h2>
      <div class="description">Desempenho est√°vel com ilumina√ß√£o constante.</div>
      <div class="report adequada">Instabilidade: Adequada</div>
    </div>

    <div class="sensor comprometida-borda">
      <h2>Sensor LDR 8</h2>
      <div class="description">Oscila√ß√µes percept√≠veis ao anoitecer.</div>
      <div class="report comprometida">Instabilidade: Comprometida</div>
    </div>

    <div class="sensor adequada-borda"">
      <h2>Sensor LDR 9</h2>
      <div class="description">Desempenho est√°vel com ilumina√ß√£o constante.</div>
      <div class="report adequada">Instabilidade: Adequada</div>
    </div>

    <div class="sensor adequada-borda">
      <h2>Sensor LDR 10</h2>
      <div class="description">Desempenho est√°vel com ilumina√ß√£o constante.</div>
      <div class="report adequada">Instabilidade: Adequada</div>
    </div>

    <div class="sensor comprometida-borda">
      <h2>Sensor LDR 11</h2>
      <div class="description">Performance incoerente sob luz difusa.</div>
      <div class="report comprometida">Instabilidade: Comprometida</div>
    </div>

    <div class="sensor adequada-borda">
      <h2>Sensor LDR 12</h2>
      <div class="description">Desempenho est√°vel com ilumina√ß√£o constante.</div>
      <div class="report adequada">Instabilidade: Adequada</div>
    </div>

    <div class="sensor adequada-borda">
      <h2>Sensor LDR 13</h2>
      <div class="description">Desempenho est√°vel com ilumina√ß√£o constante.</div>
      <div class="report adequada">Instabilidade: Adequada</div>
    </div>

  </div>
  </div>
`;
var mensagemTodos = `<ul>
  <li>
    <strong>Sensores em risco:</strong>
    <p>Atualmente, n√£o h√° sensores com mal funcionamento ou em risco. Todos os sensores da fazenda est√£o operando dentro dos par√¢metros normais, garantindo o monitoramento adequado e constante das condi√ß√µes ambientais, como temperatura, umidade e luminosidade.</p>
  </li>
  <li>
    <strong>N√≠vel de Luminosidade atual:</strong>
    <p>O n√≠vel de luminosidade atual √© de 934 unidades, o que indica uma ilumina√ß√£o excelente e adequada para o ambiente da fazenda de ostras. Este valor √© constantemente monitorado para garantir que as condi√ß√µes ideais de luminosidade sejam mantidas para o cultivo das ostras.</p>
  </li>
  <li>
    <strong>Instabilidade luminosa:</strong>
    <p>A m√©trica que define se h√° alguma inst√¢ncia de instabilidade adequada, comprometida, critica ou inoperante nos sensores LDR registrados.</p>
  </li>
  <li>
    <strong>Luminosidade Ideal:</strong>
    <p>A luminosidade da fazenda est√° atualmente dentro dos par√¢metros ideais, garantindo condi√ß√µes √≥timas para o cultivo de ostras. O sistema de controle ajusta automaticamente os n√≠veis de luminosidade para manter a intensidade da luz dentro da faixa mais eficiente para o crescimento das ostras e o desenvolvimento das algas.</p>
  </li>
</ul>`;
var mensagemIdeal = `<p>

  A qualidade da luz dispon√≠vel na fazenda influencia diretamente a sa√∫de e o crescimento das ostras. Nosso sistema classifica a luminosidade em tr√™s n√≠veis:<br><br>

  ‚úÖ <strong>Ideal:</strong> A luz est√° na faixa recomendada para o cultivo, garantindo condi√ß√µes ideais para a fotoss√≠ntese do fitopl√¢ncton, alimento natural das ostras.<br><br>

  ‚ö†Ô∏è <strong>Prec√°rio:</strong> A luminosidade est√° abaixo do necess√°rio. Isso pode afetar o crescimento das ostras e sinaliza necessidade de interven√ß√£o (ex: reposicionamento de sensores, limpeza de estruturas).<br><br>

  ‚ùå <strong>Excessivo:</strong> A luz est√° muito intensa. Isso pode aquecer demais a √°gua, causar estresse nos moluscos ou favorecer o crescimento de organismos indesejados.<br><br>

  Mantenha o ambiente sob monitoramento constante para evitar preju√≠zos √† produ√ß√£o.
</p>
`;
var mensagemMedia = `<p>

  Este valor representa a m√©dia da luminosidade coletada em tempo real por todos os sensores espalhados pela fazenda de ostras.<br><br>

  üîç A m√©dia √© calculada automaticamente com base nas √∫ltimas leituras recebidas, oferecendo uma vis√£o geral do ambiente luminoso em toda a fazenda.<br><br>

  ‚úÖ <strong>Por que √© importante?</strong><br>
  Uma m√©dia equilibrada indica que, no geral, as condi√ß√µes est√£o favor√°veis. Isso ajuda a evitar decis√µes baseadas em um √∫nico ponto de leitura isolado, permitindo a√ß√µes mais precisas e eficazes.<br><br>

  ‚ö†Ô∏è <strong>Quando ficar de olho:</strong><br>
  Se a m√©dia estiver muito alta ou muito baixa, mesmo que alguns sensores estejam dentro dos padr√µes, pode ser sinal de que √°reas maiores est√£o em risco e precisam de aten√ß√£o.<br><br>

  O monitoramento constante garante o equil√≠brio do ecossistema e otimiza o cultivo das ostras.
</p>
`;

      if (tipo === 'sensores') {
        title.textContent = "Sensores em risco";
        text.textContent = "Atualmente n√£o h√° sensores com mal funcionamento. Tudo est√° operando normalmente, sem alertas cr√≠ticos.";
      } else if (tipo === 'luminosidade') {
        title.textContent = "N√≠vel de Luminosidade";
        text.innerHTML = `${mensagemMedia}`;
      } else if (tipo === 'instabilidade') {
        title.textContent = "Instabilidade Luminosa";
        text.innerHTML = `${mensagemInstabilidade}`;
      } else if (tipo === 'ideal') {
        title.textContent = "Luminosidade Ideal";
        text.innerHTML = `${mensagemIdeal}`;
      } else if (tipo == 'todos') {
        text.innerHTML = `${mensagemTodos}`;
      }else if(tipo == 'modal-linhas'){
        text.innerHTML = `${mensagemLinhas}`;
      }else if(tipo == 'modal-barras'){
        text.innerHTML = `${mensagemBarras}`;        
      }else if(tipo == 'modal-donut'){
        text.innerHTML = `${mensagemDonut}`;
      }else if(tipo == 'modal-economia'){
        text.innerHTML = `${mensagemEconomia}`;
      }else if(tipo == 'modal-lucro'){
        text.innerHTML = `${mensagemLucro}`;
      }else if(tipo == 'modal-temporizador'){
        text.innerHTML = `${mensagemTemporizador}`;
      }

      modal.style.display = "flex"; // Exibe o modal
    }

    // Fun√ß√£o para fechar o modal
    function closeModal() {
      const modal = document.getElementById("myModal");
      modal.style.display = "none"; // Esconde o modal
    }

    // Fechar o modal se clicar fora dele
    window.onclick = function (event) {
      const modal = document.getElementById("myModal");
      if (event.target === modal) {
        modal.style.display = "none";
      }
    }
  </script>


<script>
  function iniciarTemporizador(cicloHoras = 12) {
    const display = document.getElementById('temporizador');
    const estadoTexto = document.getElementById('estado');
    const cicloMs = cicloHoras * 60 * 60 * 1000;

    // Recupera as informa√ß√µes do localStorage
    let fim = localStorage.getItem('fim');
    let ultimoCheck = localStorage.getItem('ultimoCheck');
    let emLuz = localStorage.getItem('emLuz') === 'true';
    
    // Se n√£o houver dado de "fim", iniciamos um novo ciclo
    if (!fim) {
      fim = Date.now() + cicloMs;
      localStorage.setItem('fim', fim);
    }

    // Se n√£o houver dado de "√∫ltima verifica√ß√£o", iniciamos agora
    if (!ultimoCheck) {
      ultimoCheck = Date.now();
      localStorage.setItem('ultimoCheck', ultimoCheck);
    }

    // Atualiza o estado de LUZ ou ESCURO
    if (emLuz) {
      estadoTexto.textContent = 'na LUZ';
      estadoTexto.style.color = 'orange';
    } else {
      estadoTexto.textContent = 'no ESCURO';
      estadoTexto.style.color = 'blue';
    }

    // Atualiza o temporizador a cada segundo
    setInterval(() => {
      const agora = Date.now();
      let elapsedTime = agora - ultimoCheck; // Tempo desde a √∫ltima atualiza√ß√£o
      let restante = fim - agora; // Tempo restante

      // Se o tempo acabar, reinicia o ciclo
      if (restante <= 0) {
        fim = Date.now() + cicloMs;
        emLuz = !emLuz; // Alterna para LUZ ou ESCURO

        // Atualiza o estado na tela
        if (emLuz) {
          estadoTexto.textContent = 'na LUZ';
          estadoTexto.style.color = 'orange';
        } else {
          estadoTexto.textContent = 'no ESCURO';
          estadoTexto.style.color = 'blue';
        }

        // Salva os novos dados no localStorage
        localStorage.setItem('fim', fim);
        localStorage.setItem('emLuz', emLuz);
      }

      // Atualiza o "√∫ltimo check" apenas quando o ciclo for reiniciado
      if (restante <= 0) {
        localStorage.setItem('ultimoCheck', Date.now());
      }

      // Formata o tempo restante corretamente
      const horas = Math.floor(restante / (1000 * 60 * 60));
      const minutos = Math.floor((restante % (1000 * 60 * 60)) / (1000 * 60));
      const segundos = Math.floor((restante % (1000 * 60)) / 1000);

      // Atualiza o display do temporizador
      display.textContent =
        String(horas).padStart(2, '0') + ':' +
        String(minutos).padStart(2, '0') + ':' +
        String(segundos).padStart(2, '0');

    }, 1000);
  }

  // Inicia o temporizador quando a p√°gina for carregada
  iniciarTemporizador();
</script>

  

</body>

</html>